https://202041525381.signin.aws.amazon.com/console


------------------------------------------------------------------------
Questions
EC2 Custom AMI vs Custom Template

------------------------------------------------------------------------------------------------------------------------------------------
https://yourlearning.ibm.com/activity/URL-AA49C4823B02

https://smarter-gbs.yourlearning.ibm.com/#/cpt/roadmap/1725


--------AWS Certification Material---------------------------
Amazon Web Services (AWS) Certified - 4 Certifications!

Exam Readiness: AWS Certified Solutions Architect – Associate (Digital) Free
https://www.aws.training/Details/Curriculum?id=20685

Exam Readiness: AWS Certified Developer – Associate (Digital)
https://www.aws.training/Details/Curriculum?id=19185

Free AWS Material
https://digitalcloud.training/amazon-aws-free-certification-training-solutions-architect/

https://aws.amazon.com/certification/certification-prep/


AWS Free Digital Training
https://www.aws.training/LearningLibrary?filters=language%3A1&filters=digital%3A1&tab=view_all


Neal Davis
https://digitalcloud.training/aws-csaa-hands-on-labs-downloads/

AWS Cloud Practitioner Essentials (Second Edition) Prerequsite
Good https://www.aws.training/Details/Curriculum?id=27076


download 
AWS Certified Solutions Architect Official Study Guide


---------AWS Badges---------------------------------AWS Certified Solutions Architect - Associate ----COURSE (skillsoft)----------------------------------------------------------------------
https://learn.percipio.com/channels/783c9bb0-2b77-11e7-9d24-490aed2acd57

1) AWS Associate Solutions Architect 2020: Identity & Access Management
https://share.percipio.com/cd/JrXPzVbEL


---------------------------------------Udemy Ranga AWS Course----------------------------------------------------------------------

Provisioning (renting ) resources and don't buy
Also called on-demand resource provisioning
rent based on the demand

Pay per use
No upfront planing required
avoid undifferentiated heavy lifted

Challenging
building cloud enabled applications

root user have both programmatic and AWS mgmt console

policy can be assigned to an individual users as well as on a group
called Managed policies (ie managed by AWS)

Regions and Zones

1) slow access from other parts of the world (High Latency)
2) wjhat if that data center crashes (low availability)
3) what if entire region go download

Most Services are regional services
region can be changed 

Global Services
ie IAM  can't change regions

Choose region based on
	ur users are located
	ur data is located
	regulatory and security compliance

Availability zone
isolate locations  in region
Each zone has at least two AZs
Increase availability of applications in the same Region
availability zone is physically separated from each other
AZ consists of data centers
AZs are connected thorh high throuput network, low letency

US West (Oregon) in cosole = us-west-2 in CLI

Choosing Regions
availabilty of the service in that region (most services we require)
As Each region expose is regional services endpoints 
latency, cost and data residency (complaint with bussiness contaractual reqiments)


Region
ap-south-1

Availability Zone (ends regions with a alphabet)
ap-south-1a 
ap-south-1b
ap-south-1c

They provide High Availability and Low Latency

AWS SDK
interact aws sevices ffrom our code

AWS as Identoy provider 
its a managed service 
single point of faiuler, high avaiable,

Control Plane
Data Plane

AWS Federaton
centraly managed to access AWS resources
single singn on
SAML security access markup language 
cross account acccess
OPENid connect (OIDC) tokens 
AD is a common Identity provider

AWS SSPO can interact with Active Direcoity
Amazon Congnito 


account name, pwd and email address of root user can be changed 

MFA 
multi-factor authentication 
can be used to delete S3 objets

IAM Roles
delegate access eg. apps to EC2 for S3 bucket
cross-account access
	crete IAM policy to trust account
identity federation (outside aws ) using identity broker application


IAM --> Security Status -- Activate MFA
Activate MFA
Virtual MFA device
Install Google Authtication to your mobile
show the QR code
after registering the code on the device I need to 
provide the code


AWS Support offers four support plans: 
Basic, Developer, Business, and Enterprise.


----------------------------------------------EC2-----------------------------------------------------------------------------------
elastic compute cloud
ec2 instances are virtual server
billed by second
EC2 service provisioned EC2 instances/virtual servers
	creates and manage life cycle of ec2 instances,
	load balancing and auto-scaling ,
	attach storage
	manage network

Security Group
is like a Virtual Firewall having inbound/outbound rules

Instnce Types
compute CPU,GPU

t2.micro
t is instance family (t is General purpose instance)
2 is generation 
micro size
   nano<micro<small<medium<large<xlarge

1) Change Region to 
	Asia Pacific (Mumbai) ap-south-1
2) EC2 --> Create instances
3) AMI Amazon Machine Image
	Amazon Linux 2 AMI (HVM), SSD Volume Type	
	
4) Security Group
	my-EC2-security-group	
	
5) create new keypair file
and download EC2-keypair.perm at 
C:\Users\AliImran\Box Sync\P52\My-Learning\My-AWS\Architect\in28Minutes-AWS\LABS

6) Connect
EC2 Instance Connect (browser-based SSH connection)

whoami
python --version

6) Security Group 
Add

HTTP
AnyWhere

All ICMP ipv4  (used for ping public ip)
AnyWhere


7)
Open Command Prompt
cd C:\Users\AliImran\Box Sync\P52\My-Learning\My-AWS\Architect\in28Minutes-AWS\LABS
ssh -i "EC2-keypair.pem" ec2-user@ec2-13-234-77-166.ap-south-1.compute.amazonaws.com


8) 
sudo su
yum update -y
yum install httpd
systemctl start httpd
systemctl enable httpd
echo "Hello World" > /var/www/html/index.html
 

 
curl -s http://13.234.77.166/latest/dynamic/instance-identity/document > /var/www/html/index.html

1) EC2 instance metadata service 
get details about EC2 instance

URL accessible within he EC2 instance only
http://url/lates/meta-data/

curl http://ec2-13-234-77-166.ap-south-1.compute.amazonaws.com/latest/meta-data/ami-id/
curl http://13.234.77.166/latest/meta-data/hostname
curl http://13.234.77.166/latest/meta-data/instance-id
curl http://13.234.77.166/latest/meta-data/instance-type



curl -L http://13.234.77.166/latest/meta-data/

You can get
AMI Id
Storage  Devices
DNS hostname
instance id
instance type
security groups
IP addresses

2) dynamic data service

curl http://13.234.77.166/latest/dynamic
curl http://13.234.77.166/latest/dynamic/instance-identity
curl http://13.234.77.166/latest/dynamic/instance-identity/document
 

9) 

echo "EC2 Instance-2 with ($(whoami) ) on host ($(hostname)) with ip ($(hostname -i))" > /var/www/html/index.html

curl http://localhost/latest/dynamic/instance-identity/document > /var/www/html/index.html


Security Group 
defence in depth

if there is no rules , no traffic is allowed 
you can specific only allow rules only rest is not allowed by default
can assign upto 5 security groups
No restart is required for Ec2
* Security Group are stateful , if outgoing/incoming is allowed, the incoming  response for it is automatically allowed
timeout in case of security group not allowed

EC2 IP Addresses

Public address
internet addressable

Private address
internal to the corporate network

Can't have two resources with same public IP address
however, two diff corporate networks can have resources with same private IP address
All Ec2 instnces are sigged to private I{P address but public is not assiged autmatically
Stop/Start Public IP is changed but private is same 
reboot will not change public IP

------------Elastic IP-----
constant IIP
Normally  where 1 instance is required it is ok

Go to Ec2
Elastic IPs
Allocate an IP
Action Associate with instnace

Now in instance the public IP is associated with the elastic ip
when instance is stopped even elastic IP is there 

*** Elastic IPs can  be swithced to other ec2 insce within the SAME region
they need to be manually detached
*** If elastic ip is not in used or if ec2 instance associated with it is stopped  then u will be charged
better is to relase the elatic ip

----------EC2 HTTP Server Setup--------------
userdata
script used at launch of the instance

bootstraping 
install os patches or sofware when ec2 instance is launched

Create another Ec2 isntance

Add below in the userdata
#!/bin/bash
yum update -y
yum install httpd
systemctl start httpd
systemctl enable httpd
echo "EC2 Instance-2 with ($(whoami) ) on host ($(hostname)) with ip ($(hostname -i))" > /var/www/html/index.html


sudo su
yum update -y
yum install httpd
systemctl start httpd
systemctl enable httpd
echo "EC2 Instance-2 with ($(whoami) ) on host ($(hostname)) with ip ($(hostname -i))" > /var/www/html/index.html

cd C:\Users\AliImran\Box Sync\P52\My-Learning\My-AWS\Architect\in28Minutes-AWS\LABS
ssh -i "EC2-keypair.pem" ec2-user@ec2-35-154-93-55.ap-south-1.compute.amazonaws.com


http://ec2-35-154-93-55.ap-south-1.compute.amazonaws.com

----------------------------------------------Launch Template userdata-------------------------------------------------------

Use launch templates to automate instance launches, simplify permission policies, 
and enforce best practices across your organization. Save launch parameters in a template 
that can be used for on-demand launches and with managed services, including 
EC2 Auto Scaling and EC2 Fleet. Easily update your launch parameters by creating a 
new launch template version.

EC2 --> Launch templates --> Create launch template

Name
MyEC2Template

AMI
Amazon Linux 2 AMI (HVM), SSD Volume Type - ami-09a7bbd08886aafdf (64-bit x86) / ami-011abae98ef4c1bfa (64-bit Arm)

Instance Type
t2.micro

Keypair 
EC2-keypair

Security Group
my-EC2-security-group

userdata

#!/bin/bash
yum update -y
yum install -y httpd
systemctl start httpd
systemctl enable httpd
echo "EC2 Instance with ($(whoami) ) on host ($(hostname)) with ip ($(hostname -i))" > /var/www/html/index.html

Go to Instances
Launch Instance from template
Select MyEC2template

http://ec2-3-7-66-215.ap-south-1.compute.amazonaws.com/
EC2 Instance with (root ) on host (ip-172-31-14-110.ap-south-1.compute.internal) with ip (172.31.14.110)

http://ec2-13-233-53-139.ap-south-1.compute.amazonaws.com
EC2 Instance with (root ) on host (ip-172-31-13-231.ap-south-1.compute.internal) with ip (172.31.13.231) 


----------------------------------------------Customised AMI-------------------------------------------------------

for installing OS patches and software using userdata at the launch of EC2 isntance increases bootup time
also called Hardening an Image cusomised EC2 images to your ciporate securiyt standards)

Select a running instance
Action - Image -- Create Image
Name
MyCusomizedEc2AMI

Create Image
Once Image is created go to

Go to AMI
Now Launch Template (template can have multiple version)
Action - Modify template
create new version  V2

Go to Template
Create instance from template
select V2

AMI Image contains
OS and software on that instnaces
have root volume also attach non root volumes
can be shared with other accounts (Permissions -- add account no.)
AMI are stored in S3 and are region specific, so can be created instancees in AZs of that region
better to backup AMI in other resions for DR (Copy AMI to other regions)

Three AMI sources
1) by AWS
2) AWS market Place  Per hour billing
3) Customised AMI


AMI - Action -- DeregisterAMI
SnapShot- Action- Delete

Trouble shooting
EC2-keypair.pem is the private key
chmod 400 EC2-keypair.pem (read only to the owner)
as 0777(default , v open) not recommended
use public DNS or IP to connect 


for windows instances
1) private key
2) admin pwd
decrypt the pwd using private key and login via RDP
3) Security group allow (otherwise timeout can probably come)
SSH 22
RDP 3389

EC2 uses public key cryptography using RSA
public key is stored in EC2 insance
private key is stored by cusomer


For putty
create ec2_instance1_KP.ppk using puttygen and coonect to EC2 instance

If you stopped EC2 instances then still EBS volumes (harddisk) will be there and u will be charged

----------------------------------------------Good EC2 Scenarios------------------------------------------------------

Q1:  identify all instances belonging to a project, to an eviroment
SOL: tags

Q2: Change instance type
SOL: stop the instance and then change its type

Q3: don't want an EC2 instance to be automatically  terminated 
ie from Action-Instace Sate- Terminate
SOL: Change Termination Protection to Enable
also can be set during instance creation
But EC2 Terminal protection is not effective for termination from
1) Auto Scaling Groups (ASG)
2) Spot Instances
3) OS shutdown

Q4: Update EC2 instance to a new AMI with latest patches
SOL:create/relaunch a new instance with updated AMI

Q5: create EC2 instances based on on-premise VMs
SOL: yes, using import/export , you are responsible for licenses

Q6:Changing security group
SOL: easily chnage/delete securoy group to an instance
multiple security group can also be assigned

Q7: Timeout
SOL:	inbound rule for security group to check

Q8: Installing a lot of woftwares sing userdata that slowing down instance launch
how to make it faster
SOL:	cusom AMI-------------------------------------------------------

Q9: stopped EC2 instance, will I get bill
SOL:	if u have storage 

Turn On Termination Protection to protect EC2 instances for termination
as this option will disable terminate menu

-------------------------Creating EC2 in different Zones--------------------------------------------------------------------------------------------------------

No. of Availability Zones in a Region = No. of subnets 

Services - VPC

A VPC is created default in every region


----------------------------Billing in AWS---------------------------------------------------------------------------------

1) Set Billing Alerts
2) Monitor Every day for first week
3)

My Account
IAM User and Role Access to Billing Information
Activate IAM Access

Billing Alerts
My Billing Dashboard
Billing Preference

CloudWatch

1) At the moment, CloudWatch displays all billing data and alarms in US East (N. Virginia)
so switch to it

2) Select Billing

3) Create Billing alert

4) create SNS topic
CloudWatch_Alarms_Topic

monitoring service and trigger alarm
create alarm
create topic


1) Gto to Budget
2) create a new budget 
MonthlyBudget

3) Monthly
4) Budgeted amount 
$1

----------------------------------Load Balancing---------------------------------------------------------
Elastic Load Balancer (managed service, and auto scaled (highly available)
used for LB and distribute load for EC2 
these EC2 instances can be in multiple AZ within a region
ELB can be public (accessible over internet ) or private to aws network
distribute loads to the healthy instances using health check

Each layer makes use of layers beneath it

App Layer layer 7  (HTTP, SMTP)  make api calls

Transport Layer 4  TCP TLS (secure TCP), UDP(high performance over reliability)  ensure bits/bytes transferred properly and order

Network Layer Layer 3 (IP) transferring bits/bytes
 
 3 Types of ELB
 
 (1) Classic LB (Layer 4 (TCP/TLS & UDP) and layer 7 (http/https) )
not recommanded by AWS
older version of ELB


2) Application Load Balancer (Layer 7)
new generation , advance routing ,http/https

3) Network load Balancer (Layer 4)
very high performance TCP/TLS & UDP

Create a Classic Load Balancer

1) AWS Services -> EC2 - Load Balancer-> create loadbalancer
Type: Classic Load Balancer (Previous Generation)
Choose a Classic Load Balancer when you have an existing application running in the EC2-Classic network.
Name: My-Classic-LB
Security Group : My-LB-Security-Group

Health Check
Ping Path: /
Response Timeout: 5 sec
Interval: 20 sec
Unhealthy Threshold: 22) 
healthy Threshold: 220	

Add EC2 instances:

Enable Connection Draining : 300 sec



EC2 Instance 1
http://ec2-3-6-94-201.ap-south-1.compute.amazonaws.com
EC2 Instance with (root ) on host (ip-172-31-35-58.ap-south-1.compute.internal) with ip (172.31.35.58)

EC2 Instance 2
http://ec2-13-234-204-76.ap-south-1.compute.amazonaws.com
EC2 Instance with (root ) on host (ip-172-31-34-29.ap-south-1.compute.internal) with ip (172.31.34.29)

Load balancer  DNS
http://My-Classic-LB-1642051479.ap-south-1.elb.amazonaws.com

Now Delete the Load Balancer using Action

2) Application Load Balncer  layer 7
most frequent used
supports websockets http/https
supports all supporting load balancer features
scale automatically
it is a managed service
but we are responsible of scaling EC2 instances
it can also LB with container applications/ web app
also can lB using Lambdas 


EC2 - Load Balancer - Application Load Balancer (Type)


Name: My-Application-LB
Internet-facing
ip address type: 	ipv4

select all availability zones

Cross Zone LB is enabled defaulty

Security Group (to control traffic using rules) : My-ALB-Security-Group

Configure Routing
Your load balancer routes requests to the targets in this target group using the protocol and port that you specify, and performs health checks on the targets using these health check settings. 
***Note that each target group can be associated with only one load balancer

--------Target Group-------------------------------
Target Group (used to group EC2 instances/lambday/ or set of IP ) for LB to distribute load)
My-EC2-Target-Group1
type: instances

De-registration delay
How long should ELB wait before de-registering a target.
This setting ensure that the load balancer gives in-flight requests a chance to complete excution
default is 300 seconds upto an hour , also called Connection draining
eg .it will not enterain new request but wait for 300 sec and then de register the ec2 instance

slow start duration
when a target is ready 
eg. 10 sec after 10 sec it will send request to newly instance

Algorithm
Round robin 1 by 1
Lest outstanding request 

Stickiness
enable  (for session mgmt, send all request by a same user to the same instnave
imlemented using cookie
supported by ALB and CLB

-------------------------------

Security Group : My-LB-Security-Group

Register Targets
Register targets with your target group. 
If you register a target in an enabled Availability Zone, the load balancer starts routing requests to the targets as soon as the registration process completes and the target passes the initial health checks.

select all instances - Create
DNS Name
http://My-Application-LB-284230688.ap-south-1.elb.amazonaws.com


To restrict traffic of EC2 instacnes directly insested of Load Blancer

Select EC2 instance 
Edit Security Group
Inbound Rule
Add Load Balancer Security group


Add a new Listner
port 8080
response 200
fixed response

Security Group of LB
add inbound
8080

http://My-Application-LB-284230688.ap-south-1.elb.amazonaws.com:8080


-------------------------------------------------------------------------------------------------------------------
User data for Microservice


** One ALB can support multiple Microservice
Create a separate target group for each Microservice

*** Classic LB doesn't support multiple target groups


Listener Rules
configure multiple listener rules for the same listener
rules are executed in the order they are configured
default rule executed at the end


Create a new EC2 instance from Template
Select instance with Tag  InstanceForMicroserviceA
add userdata as below

#!/bin/bash
yum update -y
yum install -y httpd
systemctl start httpd
systemctl enable httpd
echo "EC2 Instance  for MicroService Awith ($(whoami) ) on host ($(hostname)) with ip ($(hostname -i))" > /var/www/html/index.html
mkdir /var/www/html/a
echo "Microservice A Called with ip ($(hostname -i))" > /var/www/html/a/test.html


create a new Target Group TargetGroup-MicroserviceA
Register new EC2 instance with that Target Group
Go to My-Application-LB - > Select exisitng HTTP Listner --> view/edit rules
Add Rule
if Path /a/*  THEN forward it to TargetGroup-MicroserviceA


http://my-application-lb-284230688.ap-south-1.elb.amazonaws.com/a/test.html
Microservice A Called with ip (172.31.10.46)

Lister Rules possibilities
1) based  on path = test.com/a to target group A`
2) based  on Host = a.abc.com  to target group A`
3) HTTP header and methods (GET/POST)
4) Query String   (/microservice?name=A)  o target group A , (/microservice?name=B)  o target group B
5) Based on IP all request from a range of IP to a TG A, other to TG B

 Each Lister have (protocol + port)

---------------------------Auto Scaling Groups`------------------------------------------------------------

scale out : increase instances
scale in:    decrease instances
 
ASG maintained a configured no. of instances
scale in and scale out automatically to adjust load
ASG can launch on-demand,spot or both
Best practice: use Launch template with ASG
ALB can adjust and distribute load to healthy instance



EC2- > AutoScaling Group
Create ASG
Auto Scaling group name: MyEC2AutoScalingGroup
	Launch Template (EC2 instance size,AMI) - create new launch template -> My-ASG-Launch-Template
	Source Template: MyEC2Template with latest version
Add all Subnets
Enable load balancing = YES
Create New Target Group = ASG-TargetGroup (with  no. EC2 instances registered)

Configure group size and scaling policies
Desired Capacity = 2
Min Capacity 		 = 1
Max Capacity 		 = 3

Policy 
TargetTrackingPolicy
Policy type:
Target tracking scaling
Execute policy when:
As required to maintain Average CPU utilization at 70
70

*** Even  if policy indicates, ASG ensure the desired capicty 

IMP use cases

1) maintained current instance levels at ll times
min=max=desired == CONSTANT
when always there is constant load expected

2) Scale Manual
change desired capacity as needed
you need complete control over scaling 

3) Scale based on schedule
programs with regular schedules
Create Schedule Action

4) Dynamic/Automatic Scaling 
On demand Scale
Unpredictable load

Types of Dynamic Scaling

1) Target Tracking
Maintain CPU utilisation at 70%
Modify current capacity based on the target value for a specific metric

2) Simple Scaling
more complex policy
+5 if CPU utilisation > 80%
-3 if CPU utilisation < 60%
waits for cool down period before triggering additional actions

3) Step Scaling
+1 if CPU utilisation between 70% and 80%
+3 if CPU utilisation between 80% and 100% 
Warm up time can be configured for each instance.

Cloud watch
monitor metrics 

CW Alarm -> Auto Scaling -> EC2 instances

CW Alarm (if CPU > 80%)
Scaling Action (+5 EC2 instances)

CloudWatch --> Alarms

Auto Scaling Scenarios

1) change instance type or size of ASG instances
OR 
roll out a new security patch (new AMI) to all ASG instances.
Sol:
launch configuration or launch template cannot be edited
create a new version and ASG use that  version
Terminate instances in small groups to make sure application is available

2)  Perform actions before instance added/remove
Create a lifecycle hook , configure clodwatch to trigger actions based on it

Auto scaling Group --> Instance Management --> Life-cycle hooks
create life-cycle hook

MyLiifeCycle

3) which instance is terminated first when scale in
based on termination policy
default is distribute instances across AZ then based on old instance


EC2 -> Auto Scaling groups -> MyEC2AutoScalingGroupASG 
Advance configurations
Termination policies


4) Prevent frequent scale up/down
Adjust cooldown perod to a high value default 300 sec

5) I want to protect newly launched instance from scale-in 
Enable instance scaling protection
if enabled then all new instaces from this ASG will not be scale in


Deleting LB and Target groups

1) Delete ALB
2) ASG Delete (will automatically delete the instances)
3) Delete Target Groups


---------Network Load Balancer---------layer 4 UDP-----------------
*** A static / Elstic IP can be assigned with NLB
can load balance EC2, ECS (container- appl, web apps using IP address)
No support for Lambdas

Name: My-Network-LB
Protocol Listener : TCP port: 80

Configure routing
TargetGroup : TargetGroupForNLB
Register Targets: Add instances

DNS
http://My-Network-LB-69ad0058bb90cba2.elb.ap-south-1.amazonaws.com

** There is no security groups at the NLB

Attributes that can be changed 
Delete Protection
Cross Zone load balancing
Access log`ie sent to S3


1)  Delete NLB : My-Network-LB
2)  Delete TargetGroup : TargetGroupForNLB
3)   Terminates all instances


Both ALB and NLB supports sticky sessions

------------------------------------Availability-------------------------------------------------------------

Are applications are available when users need them
Percentage of time
99.99% is four 9s availability

99.95% 		22 mins down time in a month
99.99%   	4.5 mins
99.9995 	26 seconds 

To achieve Availability

1) use LB
2) deploy EC2 instances to multiple AZ's
3) use cross Zone LB
4) Deploy to multiple region
5) configure EC2 and ELB health checks

ALB by default enabled Cross Zone LB
CLB and NLB it need to be enabled

----------------------Scalability ----------------------------------------

Ability to serve more growth increase proportionally with resources.
handle user growth, traffic and data size without effecting performance

1) Deploy to bigger instance vertical scale
hd,cpu,ram,i/o
there are limits to VS
it is expensive
increase EC2 instance size ie t2.micro to t2.small

2) Horizontal scaling
Deploying multiple instance of app/db
it also increase availability

Additional infrastructure needed

Distribute instances

1) Distribute EC2 in a single AZ in same Region
2) Distribute EC2 in a multiple AZ in same Region
3) Distribute EC2 in a multiple AZ in multiple Region

Auto Scale Group

Distribute load : ELB , Route53(for multiple regions)
ELB is managed so no need to think about its scaling

EC2 instance Families

m ( m4,m5,m6 General purpose)
web servers and code repos

t (t2,t3,t3a) Brustable performance (accumulated CPU  credits)
workload with spikes, dev env , small db
unlimted mode (spike beyond CPU credit at additional costs) off for t2 but on for t3 by default


c (c4,c5,c5n ) Compute optimised High performance
batch processing,High performance compute

r (r4,r5,r5a,r5n) Memory Ram  optimized
in mem db, real time analytics

i (i3,de)  storage optimised
NoSQL DB and data warehousing

g (g3,g4) GPU optimised 
video compressio, grapic processing


f  (f1) FPGA instances 
massive parallel processing power as geonomic, data analytics

inf (inf1) Machine learning ASIC instances
image,speech,nlp recognition 

Tenancy Options
shared vs dedicated

default is shared

E2 dedicated instances
virtualised instances on hardware dedicated to a customer
no visibility into the hardware of underlying host
billing per instance

E2 dedicated hosts
physical servers dedicated to one customer
regular needs, high security
billing per host
server bound software licences like windows server, sql server

------------------------Placement Groups-------------------
low latency net=work communication (instances on a same RAC), Cluster
high availability (instance on diff RAC) , Spread
Partition (multpile partitions with)

READ AAGAIN

Elastic Network Infterface

like a virtual nework inerface card
primary ENI is by default and can't be detached

ENI lives in one subnet and thus in a single AZ
one primary private IPV4 and one or more secondary PV4
one Elastic IPv4
one public IP IPV4
one or more security groupa mac addeess
ipv6

No. of EC2 isntances = No. of ENI

EC2 Partition Placement Group
In large distributed and replicated workloads (HDFS, HBase, and Cassandra), EC2 instances need to be divided into multiple groups.

------------------------------------------------------------------------------------------------
Monitoring EC2 instances
using 
CloudWatch
basic monitoring every 5 mins Free
CPU,Disk,Network are tracked by cloudwatch

CW doesn't have access to OS system metric like memory consumption
1) install cloudwatch agent on ec2
2) use cloudwatch collected plug-in

-----------EC2 Pricing Model ------------------------------------------------------

1) On demand
Request when u want it
Flexible and most expensive
ideal for spiky traffic 
batch program having unpredictable runtime

2) Spot
Quote the max 
Cheapest upto 90% off But not guarantees
not for critical apps, non time-critcal workloads
old-model = bid a price, biggest bidder wins
new model: quote your max price,based on long term trends
can a terminated with a 2 min notice
best practice: stop or hibernate instance on receiving interruption notice as for terminate a new instance will be allocated

Spot Block
request spot instances for a specific duration (1,2 hrs up to 6)

Sopt Fleet
Request spot instances across multiple instance types(micro,small,large)
to get better change to have a spot instance


3) Reserve ahead of time
up to 75% 1-3 years

4) Saving plans 
commit spending $ per hour on (EC2 or Fargate or Labmda)
up to 66% 
No restriction


---------------Launch A spot instance ---------------------------------
EC2  --> Choose instance type --> configure instance

Purchasing option --> Request Spot instances

Maximum price: 	
The maximum price you are willing to pay per instance hour. 
Your instance runs when your maximum price is greater than the Spot Price

Persistence request: 
Ensures that your request will be submitted every time your Spot Instance is terminated. 


EC2 > Spot Requests > Request Spot Instances 

for spot block use below option
Defined duration workloads Launch instances into a Spot block for 1 to 6 hours.

for spot fleet use below option
Load balancing workloads Launch instances of the same size, in any Availability Zone. Good for running web services.

Fleet request settings


EC2 Linux Spot instances - Pricing

Zero charge if terminated or stopped by Amazon EC2 in the first instance hour (60 mins)
otherwise u will be changed by seconds

terminated/stopped after 50 mins by Amazon = you pay 0
terminated/stopped after 50 mins by you = you pay for 50 mins
terminated/stopped after 70 mins by you/Amazon = you bay for 70 mins


when interrupted, spot instances can be terminated (default),stopped and hibernated

Completely close a spot request  in the following order for best practice

1) cancel spot request  (only this can't terminate active spot instaces)
2) terminate all spot instances

---------------------EC2 Reserved instances ------------------------------
Reserve E2 instances ahead of time

when u have constant worloads that run all the time
3 types
1) STANDARD

In a region, i reserve EC2 instance with a specific platform,instance type for a term of 1 or 3 years.
can switch to other instance sizes within the same instance family ie t2.micro to t2.small,large
AZ can also be changed
Instance family , os or tenancies (shared/dedicated) CAN'T be changed
up to 75% off

2) CONVERTIBLE (with  some flexibility)

In a region, i reserve EC2 instance for a term of 1 or 3 years.
can switch to other instance sizes within the same instance family ie t2.micro to t2.small,large
AZ can also be changed
Instance family , os or tenancies (shared/dedicated) CAN be changed
up to 54%

3) SCHEDULED
in a region, i reserve an EC2 instance par-time for a year, x hour every month/week/day at a specif time
restriction: available in few instance types C2,R3,C4,M4 in few regions 
use case: bill are generated on the first day of month
5 to 10%


You can also sell reserved on AWS reserved instance marketplace if you don't want to use your reservation.

PAYMENT
1) 0 upfront, pay monthly instalment
2) partial upfront ,
3) All upfront, 0 instalment 
all upfront < partial upfront < No upfront (a diff upto 5 %)

Saving Plans
Constant workloads that ru


https://www.ec2instances.info/

----------------Elastic Load Balancer Advance------------------------------------------------------------------

for Https we need to install ssl or tls certificates on the server
in AWS SSL certificates can be managed using AWS Certificate Manager

ELB requires X.509 certificates (ssl/tsl)

Application/Classic LB SSL TLS Termination
Client -> ELB 		https
ELB -> EC2        http

Network LB TLS Termination
Client -> NLB TLS
NLB -> EC2    TCP

---------------------------------------------Server Name Indication----------------------------------
Each listener in ALB can be associated with multiple SSL certificates (one for each website)
and SNI ServerName Indication is automatically enabled
its extension to TLS

--Monitoring ELB logs and Headers -------------------------------

ELB --> Action
Edit LB attributes
Access logs 

NLB allows EC2 intances to see client details like IP but not ALB in request header

X-Forwarded-For      Client IP
X-Forwarded-Proto   Originating protocol
X-Forwarded-Port     Originating port


IMP ALB VS NLB VS CLB read again
---------------------------------------------------------------------------------------------------
IMp LB scenarios 

1)maintain sticky session
enable stickiness on ELB (cookie name normally: AWSELB)

2)distribute load only yo healthy instances
configure health

3) configure load among 2 AZ in the same region
Enable cross zone load balancing

4) in-flight request to unhealthy instances to given opportunity to complete
enable connection draining 

5) warm up time to EC2 instances before getting load
configure health check grace period

6) protect EBL from web attacks, sql injection, cross-site-scripting
integrate ELB with WAF web application Firewall

7) Protect web app from DDoS attacks 
by default ELB provide it

-----------Architectural Considerations ----------------------------------------
 Security
 use security groups to restrict traffic
 EC2 instances in private VPC (not accessible out side AWS network)
 user dedicated hosts when u have regulatory needs
 
 Performance
 right instance family
 appropriate placement groups
 prefer custom AMI to install softwares using user data 
 choose right ELB for you use case

Cost
optimal no. and type of EC2 instance family
use right mix of 
saving , reserved , on demand , spot instances

Resiliency (how quickly u recover)
health checks
cloudwatch for monitoring
DR , ami coppied to multiple regions


warm attach = attaching ENI with EC2 instnace is stopped
spoot is the cheapest
on deman is the costly


------------------------------------------------------------------------------------

IAAS (Infrastructure as a Service)
use only INFRASTRUCTURE from cloud provider
also called Lift and Shift
eg. EC2 to deploy your applications or db

You are responsible for 
1) app code and runtime
2) configure LB
3) auto scaling
4) OS upgrade and patches
5) Availability

PAAS (platform as a service)
use a PLATFORM provided by cloud
eg EBS Elastic Beanstalk

alternative to PAAS
CAAS (container as service)container instead of applications
ECS Elastic Container Service

FAAS Function as a Service
serverless
not worrying about servers`
AWS Fargate Serverless compute for container


Cloud provider provides
1) OS
2) App runtime
3) auto scale-in, lb

You are responsible
1) Application 
2) configurations

-----Elastic Beanstalk --------------------------------------------
simplest way to deploy and scale web apps in AWS

supports java,.net,node.js,php,python,go and docker apps
Its free but chnarges for resource being consumed

automatic LB
Auto scalaing
platform update health monitoring


***** Elastic Beanstalk is not EBS (Elastic bean store)


An application can have multiple environments to be created
An  application can have multiple versions (stored in S3)

Elastic Beanstalk

Name: My-First-ElasticBeanstalk-App
Platform: Python
Application Code: Sample application

It will create an 

Environment Tier

Web Server environment (for web apps)
Worker environment (for batch )

You can retain FULL control over ASWS resources created
It is ideal for simple web applications
Not ideal for Microservice architectures
access server logs without logging into the server
logs can be stored in S3 or in ClodwWatch
can configure SNS based on health
can apply patches and platform updates


Environment : MyFirstElasticbeanstalkApp-env
Application: My-First-ElasticBeanstalk-App
EC2 instance created : i-09198c2b1b80e3fcd
a LB is created (can make changes in ELB) : awseb-AWSEB-ZV73FYBTVZ9S

URL: http://myfirstelasticbeanstalkapp-env.eba-jsbz4ebm.ap-south-1.elasticbeanstalk.com/

To Delete
1) Delete the application
it will delete EC2 and ELB 



------------------------Containers Solutions------------------------------------------------------------
Docker is cloud Neutral

Container Orchestration provides
Auto scaling (scale container based on demand)
Service Discovery (helps Microservice find others)
Self healing (replace failing instances using health check)
Zero Downtime deployments release new versions without downtime

Container Orchestration Options 

1) Cloud Neutral
	Kubernetes 
	AWS Service = AWS Elastic Kubrmetes Service (EKS)
	EKS doesn't have a free tier

2) AWS Specific
	AWS Elastic Container Service ECS
	AWS Fargate (No free tier): Serverless version of AWS ECS



AWS Elastic Container Service ECS (A regional Service)
Need to create a cluster of EC2 instance managed by ECS for Microservice
build using container images

For AWS Fargate 
No need to manage EC2 instances 

Use case 
Microservice
batch processing on ECS using AWS Batch

ECS and Fargate points to Elastic Container Service

Dont' Create 

Container definition
Amazon ECS makes it easy to deploy, manage, and scale Docker containers running applications, services, and batch processes. Amazon ECS places containers across your cluster based on your resource needs and is integrated with familiar features like Elastic Load Balancing, EC2 security groups, EBS volumes and IAM roles

Sample Applicaiton
Container Name: sample-container-Image
Image: httpd:2.4


A task definition is a blueprint for your application, and describes one or more containers through attributes. Some attributes are configured at the task level but the majority of attributes are configured per container.

Define your service
A service allows you to run and maintain a specified number (the "desired count") of simultaneous instances of a task definition in an ECS cluster.

Service Name: sample-app-service
Number of desired tasks: 2

Application Load Balancer

Configure your cluster
The infrastructure in a Fargate cluster is fully managed by AWS. Your containers run without you managing and configuring individual Amazon EC2 instances.


For Fargate
No EC2 instance created
LB is created
Target Group is created

A Task is a definition of a container
Tasks role can also be attached (RDS)
Task execution IAM role (permission to pull container images)


A existing task deification can't be changed
A tasks has IP and container details

A Service  allows to run and maintain  a specific  no. of tasks  (desired count)
it brought up new tasks in case of failure

ECS Cluster
Groping of one or more container instances (EC2 instances) when   u run your taksk

EC2 instances in a cluster running a container agent for communication

ALB features
Dynamic host port mapping  (multiple task from the same service allowed per EC2 container)
path based routing multiple services can use same listener port on same ALB and be routed based the path


Elastic Beanstalk can run container using Docker as platform but can't create clusters

Amazon EKS 
recommended if you are already using Kubernetes and want to move workload dto AWS

ECR 
Elastic Container Registry
for deploy container images



------------------
To have more access to EC2 instances for ECS
ECS --> Cluster-> Create Cluster -- Select cluster template

EC2 Linux + Networking
Resources to be created:
Cluster
VPC
Subnets
Auto Scaling group with Linux AMI



---------------------------ServerLess-----------------------------------------
You don't worry about  infrastructure
flexible scaling and automated high availability
Pay for use 
	No of requests
	duration of requests
	memory consume

Lambda called/trigger from 
Amazon API Gateway
AWS Cognito
DynamoDB (event)  chnage in DB
CloudFront (lambda@Edge)
AWS Step Functions
Kinesis (event)
S3 Simple Storage Service , new object
SQS (event) new msg in Queue
SNS Simple notification service and so on


name: MyNodeJsLambda1
runtime : Nodejs
create Event: FirstEvent
Test

create environment variable 
EnvironmentName = Development

add beow code in index.js
exports.handler = async (event) => {
    // TODO implement
    const response = {
        statusCode: 200,
        body: JSON.stringify('Hello Ali from ' + process.env.EnvironmentName),
    };
    return response;
};


AWS X-Ray (tracing)
to trace request
request granted for role
Enable it 

Matrix using AWS cloudwatch (monitoring and log)


basic setting
MEMORY = the more memory the more CPU
Price proportional to Memory 

TimeOut  of lambda function  = 3 seconds is default 
max timeout = 15 mins

stateless - store data to S3 or DynamoDB
500 MB of non persistent distk /tmp
Allocate memory in 64MB increments from 128MB to 3 GB


-----------------------------API Gateway-----------------------------------------------------

Rest API Challenges

Management of Rest API is not easy
authentication and authorization
Rate limits (quotas)
Can  Run Multiple Versions of API
Monitor API callsCache API requests
API keys for third party developers 

Full Managed Service
publish , maintain , monitoring and securing APIs
Integrate with Lambda, EC2, ECS,  or any publicly addressable web servic
supports HTTP(s) and websockets
It is serverless 

HTTP API is new version of REST API


REST API -->  New API
Name: MyHelloWolrdAPI
EndPoint Type: Regional

Regions = 20 
Edge Locations = where regions are not avaiable CloudFront distrubyte cotent 200+

Create API

Action-> Create Method -> Get

Integration Type:
Lambda Function: MyNodeJsLambda1
Save
Test

Authorizers
Name:
Type  Congnito and Lambda authorizer (JWT token or SAML)

API keys
To identifying API clients  based on key used for usagePlan

Throttling
wBrust: 800

Quota: 
total no of request in a month

Client Certificates:
to ensure HTTP requests to your back-end services are originating from API Gate
to verify requester's authenticity


Action -> Deploy API 
Deployment Stage:  New Stage
Stage Name:Dev

URL: 	https://ruvdffuyq5.execute-api.ap-south-1.amazonaws.com/Dev

Canary Deployment
sent a % request to a no. of users

-------------------------- Virtual  Private Cloud ---------------------------------------------------------

Creating own private network in the cloud
your own isolated network (traffic not visible to other AWS vps)
you can control all the traffic coming in and out a VPC
Best practice all resources from ur VPC

To separate public resource (accessible through internet) with private resources 

create public subnet for public resources and like private
public resources can talk to private 

Each VPC is associated with a Region
each subnet is created in AZ

eg VPC = us-east-1
      Subnets = us-east-1a,us-east-1b

VPC -> 
default VPC always created without a name
default subnets also created 

No. of subnets = No. of AZ

IPv4  32 bit  (allows 4.3 billion address) most popular
127.255.255.255

IPv6  128 bit alphanumeric
  
182.82.143.132/32 is a single ip 
0.0.0.0/0 all

10.88.135.144/30
means
2 rasie power (32 -30) = 4 

Each VPC is associated with a CIDR block
CIDR b;lock can be from /16 (65536 ) to /28 (16) IP addresses






































